{
	"type": "bigglobe:script",
	"config": {
		"script": {
			"debug_name": "ConfiguredFeatureOverworldSurfaceSmallFoliage",
			"source": [
				";handle cave intersecting surface.",
				"block (",
					"unless (isYLevelValid(originY): return(false))",
					"else if (getBlockState(originX, originY - 1, originZ).isReplaceable(): --originY,, continue())",
				")",

				";sigmoid curve",
				"double adjustedFoliage = 0.5 / (fastExp(-4.0 * world_traits.`bigglobe:foliage_at_surface`) + 1.0)",
				"random.unless(adjustedFoliage: return(false))",

				"BlockState existingState = getBlockState(originX, originY, originZ)",
				"BlockState newState = null",
				"if (existingState ==. 'minecraft:air':",
					"BlockState below = getBlockState(originX, originY - 1, originZ)",
					"if (below ==. 'minecraft:mud':",
						"return(false)",
					")",
					"else if (below ==. 'minecraft:blackstone': ;island volcanoes",
						"newState = 'bigglobe:charred_grass'",
					")",
					"else (",
						"double fromTemperate = world_traits.`bigglobe:temperature_at` ^ 2 + world_traits.`bigglobe:foliage_at` ^ 2",
						"double deadBushChance = fromTemperate / (fromTemperate * 8.0 + 4.0)",
						"random.if (deadBushChance:",
							"random.unless (unmixSmooth(2.0L, 6.0L, originY): return(false))",
							"newState = 'minecraft:dead_bush'",
						")",
						"else random.if (adjustedFoliage:",
							"random.if (adjustedFoliage:",
								"if (below.isIn('#minecraft:sand'):",
									"newState = BlockState?('minecraft:tall_dry_grass')",
								")",
								"else (",
									"newState = random.nextBoolean(0.125) ? 'minecraft:large_fern[half=lower]' : 'minecraft:tall_grass[half=lower]'",
								")",
							")",
							"else (",
								"if (below.isIn('#minecraft:sand'):",
									"newState = BlockState?('minecraft:short_dry_grass')",
								")",
								"else (",
									"newState = random.nextBoolean(0.125) ? 'minecraft:fern' : 'minecraft:grass'",
								")",
							")",
						")",
						"else (",
							"newState = 'bigglobe:short_grass'",
						")",
					")",
				")",
				"else if (existingState ==. 'minecraft:water[level=0]':",
					"random.if (adjustedFoliage:",
						"random.if (adjustedFoliage:",
							"newState = 'minecraft:tall_seagrass[half=lower]'",
						")",
						"else (",
							"newState = 'minecraft:seagrass'",
						")",
					")",
					"else (",
						"return(false) ;no short seagrass.",
					")",
				")",
				"else (",
					"return(false)",
				")",
				"return(newState != null && placeBlockState(originX, originY, originZ, newState))"
			]
		}
	}
}