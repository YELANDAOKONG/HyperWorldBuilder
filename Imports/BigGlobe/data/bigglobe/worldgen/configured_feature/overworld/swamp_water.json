{
	"type": "bigglobe:script",
	"config": {
		"script": [
			"class Pos(int*(x, z))",
			"boolean checkBelow(int*(x, z):",
				"getBlockState(x, originY - 1, z).isIn('#minecraft:dirt') &&",
				"getBlockState(x, originY,     z).isIn('#minecraft:dirt')",
			")",
			"boolean checkAbove(int*(x, z):",
				"BlockState state = getBlockState(x, originY + 1, z),,",
				"state.isReplaceable() || state.isIn('#bigglobe:plants')",
			")",
			"unless (checkBelow(originX, originZ) && checkAbove(originX, originZ): return(false))",
			"HashSet positions = new()",
			"ArrayList queue = new()",
			"boolean tryAdd(Pos pos:",
				"(",
					"checkBelow(pos.x - 1, pos.z) &&",
					"checkBelow(pos.x + 1, pos.z) &&",
					"checkBelow(pos.x, pos.z - 1) &&",
					"checkBelow(pos.x, pos.z + 1)",
				")",
				".if (",
					"positions.add(pos)",
					"Pos adjacent = null",
					"if (!positions.contains(adjacent := new(pos.x - 1, pos.z)) && checkAbove(adjacent.x, adjacent.z): queue.add(adjacent))",
					"if (!positions.contains(adjacent := new(pos.x + 1, pos.z)) && checkAbove(adjacent.x, adjacent.z): queue.add(adjacent))",
					"if (!positions.contains(adjacent := new(pos.x, pos.z - 1)) && checkAbove(adjacent.x, adjacent.z): queue.add(adjacent))",
					"if (!positions.contains(adjacent := new(pos.x, pos.z + 1)) && checkAbove(adjacent.x, adjacent.z): queue.add(adjacent))",
				")",
			")",
			"unless (tryAdd(Pos.new(originX, originZ)): return(false))",
			"repeat (random.nextInt(8, 33):",
				"int size = queue.size()",
				"if (size == 0: break())",
				"int index = random.nextInt(size)",
				"Pos pos = index == size - 1 ? queue.removeIndex(index) : queue.set(index, queue.removeIndex(size - 1))",
				"tryAdd(pos)",
			")",
			"for (Pos pos in positions:",
				"setBlockState(pos.x, originY - 1, pos.z, getBlockState(pos.x, originY, pos.z))",
				"setBlockState(pos.x, originY, pos.z, 'minecraft:water[level=0]')",
				"setBlockState(pos.x, originY + 1, pos.z, random.nextInt(16) == 0 ? 'minecraft:lily_pad' : 'minecraft:air')",
				"if (getBlockState(pos.x, originY + 2, pos.z).half != null:",
					"setBlockState(pos.x, originY + 2, pos.z, 'minecraft:air')",
				")",
			")",
			"return(true)"
		]
	}
}